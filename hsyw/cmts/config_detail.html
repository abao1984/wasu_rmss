<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/hsyw/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/hsyw/bootstrap/css/bootstrap-theme.min.css">
<script src="/hsyw/jquery-ui/jquery-1.10.2.js"></script>
<script src="/hsyw/bootstrap/js/bootstrap.min.js"></script>
<script src="/hsyw/jquery-ui/jquery-1.10.2.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>
<script>
$(function(){
	$.post('/hsyw/ws.asmx/get_sql_resource_list', function(data){
		var json_obj = JSON.parse(data);
		$.each(json_obj,function(index, value){
			var code = value['Bussiness_code'];
			var device = value['sbmc'];
			var client = value['khmc'];
		});
	});
	$.post("/hsyw/ws.asmx/get_sql_client_lv",function(data){
		var json_obj = JSON.parse(data);
		$.each(json_obj, function(index,value){
			var name = value['mc'];
			var id = value['lsh'];
			var option_html = '<option value="'+ id +'">' + name + '</option>'
			$('#id_client_lv').append(option_html);
		});
	});
	$.post("/hsyw/ws.asmx/get_sql_area", function(data){
		var json_obj = JSON.parse(data);
		$.each(json_obj, function(index, value){
			var name = value['mc'];
			var id = value['lsh'];
			var option_html = '<option value="'+ id +'">' + name + '</option>';
			$('#id_area').append(option_html);
		})
	});
	$.post('/hsyw/ws.asmx/get_bussiness_list')
	.done(function(result){
		var json_obj = JSON.parse(result);
		$.each(json_obj,function(index,value){
			var id = value['ID']
			var bussiness_code = value['Bussiness_code'];
			var device_code = value['sbpzxx'];
			var client_name = value['khmc'];
			
			var tr_html = '' + 
			'<tr>' +
			'<td><input type="checkbox" name="check[]" id="'+id+'"></td>'+
			'<td><a href="/hsyw/cmts/config_detail.html?id='+id+'">'+ bussiness_code +'</a></td>'+
			'<td>'+ device_code +'</td>'+
			'<td>'+ client_name +'</td>'+
			'</tr>';
				
			$('#id_configure_table').append(tr_html);
			
		})
	});
	
	var url = document.URL;
	var query_dict = getQueryDict(url);
	function getQueryDict(url)
	{
		var query = url.split('?')[1];
		var params = query.split('&');
		var data_dict = {}
		for (var i=0;i<params.length;i++)
		{
			var data = params[i];
			var key = data.split('=')[0];
			var value = data.split('=')[1];
			data_dict[key] = value;
		}
		return data_dict;
	}
	
	$.post('/hsyw/ws.asmx/get_config_detail',query_dict)
	.done(function(result){
		var json_obj = JSON.parse(result);
		var bussiness = json_obj['bussiness'];
		var cmts_list = json_obj['cmts_list'];
		var bussiness_type = json_obj['bussiness_type'];
		var client = json_obj['client'];
		
		var config_person  = bussiness.pzr;
		var config_date = bussiness.pzsj;
		$('#id_id').val(bussiness.ID);
		$('#id_bussiness_code').val(bussiness.Bussiness_code);
		$('#id_device_info').val(bussiness.sbpzxx);
		$('#id_client_name').val(bussiness.khmc);
		$('#id_config_date').val(config_date);
		$('#id_config_person').val(config_person);
		var client_code = client.khbh
		var unit = client.khmc;
		var address= client.khdz;
		var contact_person = client.khlxr;
		var client_sales = client.Xsy;
		var mobile = client.ydsj;
		$('#id_client_code').text(client_code);
		$('#id_unit').text (unit);
		$('#id_address').text(address);
		$('#id_contact_person').text(contact_person);
		$('#id_config_person').text(config_person);
		
		$('#id_mobile').text(mobile);
		
		$.each(bussiness.CMTS,function(i,v){
			var item_id = v.id;
			var item_name = v.device_code;
			var html = '<li class="list-group-item"><div class="checkbox"><label><input type="checkbox" name="check[]" data-id="'+item_id+'"><a href="/hsyw/cmts/get_cmts_detail.html?id='+ item_id +'" >'+ item_name+'</a></label></div></li>';
			$('#id_cmts_list').append(html);
		});
		
	});
	
	$('#id_save').click(function(){
		var id=$('#id_id').val();
		var bussiness_code = $('#id_bussiness_code').val();
		var device_info = $('#id_device_info').val();
		var client_name = $('#id_client_name').val();
		var config_date = $('#id_config_date').val();
		var config_person = $('#id_config_person').val();
		var post_dict = {};
		post_dict['id'] = id;
		post_dict['bussiness_code'] = bussiness_code;
		post_dict['device_info'] = device_info;
		post_dict['client_name'] = client_name;
		post_dict['config_person'] = config_person;
		post_dict['config_date'] = config_date;
		
		$.post('/hsyw/ws.asmx/edit_config',post_dict)
		.done(function(result){
			var json_obj = JSON.parse(result);
		});	
	});
	$('#id_delete_cmts').click(function(){
		var checked_checkboxes = $('input[type="checkbox"]:checked');
		var data_id_list =[];
		for (var i=0;i<checked_checkboxes.length;i++)
		{
			var node_id = $(checked_checkboxes[i]).attr('data-id');
			data_id_list.push(node_id);
		}
		var id_list = data_id_list.join(',');
		var post_data = {};
		post_data.id_list = id_list;
		$.post('/hsyw/ws.asmx/delete_cmts_list', post_data)
		.done(function(result){
			var data = JSON.parse(result);
			if (data.result ==='0')
			{
				alert ('删除成功');
				location.reload();
			}
			else
			{
				alert('操作失败：'+data.msg);
			}
			var res = searchData();
		});
	});
	var bussiness_id = query_dict['id'];
	$('#id_add_cmts').click(function(){
		window.location='/hsyw/cmts/add_cmts.html?bussiness_id='+ bussiness_id+''
	});
});
</script>
</head>
<body>
<div class="container">
<div class="row">
<div class="col-xs-12">
<p></p>
<form role="form">
<div class="panel panel-primary">
<div class="panel-heading">
业务信息
<button class="btn btn-default btn-xs pull-right" type="button" id="id_save">保存</button>
</div>
<div class="panel-body">
<div class="form-group">
<label for="id_id" class="sr-only">id</label>
<input type="hidden" name="id" id="id_id">
</div>
<div class="form-group">
	<label for="id_bussiness_code">业务编码</label>
	<input  type="text" name="bussines_code" id="id_bussiness_code" class="form-control">
</div>
<div class="form-group">
	<label for="id_device_info">设备配置信息</label>
	<input type="text" name="device_info" id="id_device_info" class="form-control">
</div>
<div class="form-group">
	<label for="id_client_name">客户名称</label>
	<input type="text" name="client_name" id="id_client_name" class="form-control">
</div>
<div class="form-group">
	<label for="id_config_person">配置人</label>
	<input type="text" name="config_person" id="id_config_person" class="form-control">
</div>
<div class="form-group">
	<label for="id_config_date">配置时间</label>
	<input type="text" name="config_date" id="id_config_date" class="form-control">
</div>
</div>
</div>

<div class="panel panel-info">
<div class="panel-heading">客户信息</div>
<div class="panel-body">
<dl class="dl-horizontal">
<dt >客户编号<dt>
<dd id="id_client_code"><dd>
<dt>用户类型<dt>
<dd id=""><dd>
<dt >接入单位<dt>
<dd id="id_unit"><dd>
<dt>销售员<dt>
<dd id="id_client_sales"><dd>
<dt>用户负责人<dt>
<dd id="id_contact_person"><dd>
<dt>座机<dt>
<dd id=""><dd>
<dt>手机<dt>
<dd id="id_mobile"><dd>
<dt>Email<dt>
<dd id=""><dd>
<dt>用户地址<dt>
<dd id="id_address"><dd>
</dl>
</div>
</div>

<div class="panel panel-default">
<div class="panel-heading">cmts
<div class="pull-right btn-group">
<button type="button" class="btn btn-default btn-xs" id="id_add_cmts">添加</button>
<button type="button" class="btn btn-danger btn-xs" id="id_delete_cmts">删除</button>
</div>
</div>
<div class="panel-body list-group" id="id_cmts_list">


</div>
</div>
</form>



</div>
</div>

</body>
</html>
